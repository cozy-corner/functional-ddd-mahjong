# 麻雀で学ぶ関数型ドメインモデリング - 学習進行TODO

## フェーズ1: Tile型定義 → Hand管理
**学習目標：型安全性とドメイン表現**

### 1.1 基本型定義 ✅
- [x] Tile型の定義（萬子、筒子、索子、字牌）
- [x] 不正な牌（萬子の10など）をコンパイル時に防ぐ設計
- [x] 基本的なTile作成関数とバリデーション

### 1.2 Hand管理 ✅
- [x] Hand型の定義（14牌の制約）
- [x] 手牌の基本操作（追加、削除、ソート）
- [x] Result型を使ったエラーハンドリング

### 1.3 テストとバリデーション ✅
- [x] TileモジュールとHandモジュールの包括的テスト
- [x] パラメータ化テストの実装
- [x] ドメインが仕様であることの実践
- [x] 予測可能な設計への改善

**習得スキル**
- [x] 型駆動設計の実践
- [x] 不変性の活用
- [x] Value Objectパターン
- [x] 基本的なResult型バリデーション
- [x] 関数型プログラミングでのテスト設計

---

## フェーズ2: Meld検出 → Winning hand判定
**学習目標：関数合成とパターンマッチング**

### 2.1 Meld型定義
- [x] 順子（Sequence）型の定義と検出関数
- [x] 刻子（Triplet）型の定義と検出関数
- [x] 雀頭（Pair）型の定義と検出関数

### 2.2 面子分解
- [ ] 14牌からの全ての面子組み合わせを検出
- [ ] 4面子1雀頭パターンの判定
- [ ] Option型を使った面子の存在表現

### 2.3 和了判定
- [ ] 有効な面子組み合わせの検証
- [ ] 和了形の判定関数
- [ ] テストケース（和了手、ノーテン手）

**習得スキル**
- [ ] 関数分解技法
- [ ] 合成可能な設計
- [ ] パターンマッチングの活用
- [ ] Maybe/Option型の活用

---

## フェーズ3: 基本役判定 → 複合役
**学習目標：Railway-Oriented Programming**

### 3.1 基本役の実装
- [ ] タンヤオ（中張牌のみ）の判定
- [ ] ピンフ（順子4つ+雀頭）の判定
- [ ] トイトイ（刻子4つ）の判定
- [ ] ホンイツ（一色+字牌）の判定

### 3.2 複合役の処理
- [ ] チンイツ（一色のみ）の判定
- [ ] サンアンコ（暗刻3つ）の判定
- [ ] 複数役の組み合わせ検証
- [ ] 役なし（ノーテン）の処理

### 3.3 エラーハンドリング
- [ ] 役判定のResult型チェーン
- [ ] 複数バリデーションの合成
- [ ] ドメインエラーの明確な表現

**習得スキル**
- [ ] Railway-Oriented Programming
- [ ] エラー合成パターン
- [ ] 型安全なエラーハンドリング
- [ ] 複数のバリデーション結果の合成

---

## フェーズ4: 点数計算 → 特殊役
**学習目標：ワークフローとドメインイベント**

### 4.1 翻数計算
- [ ] 各役の翻数定義
- [ ] 役リストから翻数合計の計算
- [ ] 40符固定での点数計算ワークフロー

### 4.2 特殊ケース
- [ ] 役満の処理（大三元、四暗刻など）
- [ ] 複合不可の役の処理
- [ ] 最高点役の選択ロジック

### 4.3 ワークフロー設計
- [ ] 手牌→役判定→点数計算の一連の流れ
- [ ] 副作用の分離と制御
- [ ] ドメインイベントによる結果の表現

**習得スキル**
- [ ] ワークフロー設計
- [ ] 副作用管理
- [ ] ドメインイベントパターン
- [ ] 高階関数による柔軟な計算ロジック

---

## 完了チェック

### 全体的な習得確認
- [ ] 型安全性：不正な状態をコンパイル時に防げている
- [ ] 関数合成：小さな関数を組み合わせて複雑なロジックを構築
- [ ] エラーハンドリング：Railway-Oriented Programmingを実践
- [ ] ドメイン表現：麻雀のルールがコードに直接表現されている
- [ ] テスト：各フェーズで適切なテストケースを作成
- [ ] パフォーマンス：関数型アプローチでも実用的な速度

### 次のステップ（拡張課題）
- [ ] 変形役（七対子、国士無双）の追加
- [ ] ゲーム状態役（リーチ、一発）の追加
- [ ] 符計算の実装
- [ ] 親子概念の追加
- [ ] ドラの実装

## メモ・学習記録

### フェーズ1.1完了 (2024-06-29)
- **実装内容**: Tile型の完全な定義とバリデーション機能
- **学習成果**: 
  - 型駆動設計により萬子の10などの不正な牌をコンパイル時に防げることを確認
  - プライベートコンストラクタとスマートコンストラクタによるValue Objectパターンの実装
  - Result型による明示的なエラーハンドリング（Railway-Oriented Programming の基礎）
- **追加実装**: 
  - 牌の比較関数（ソート機能用）
  - 文字列パース機能（"1m", "2p", "E"など）
- **次の課題**: Hand型でこれらの基礎を活用した14牌制約の実装

### フェーズ1.3完了 (2024-06-30)
- **実装内容**: TileとHandモジュールの包括的テスト実装（92テストケース）
- **学習成果**:
  - ドメイン実装が仕様であることの実践
  - パラメータ化テスト（Theory/InlineData）による効率的なテスト設計
  - 順序依存を排除した予測可能な設計への改善
- **設計改善**: 文字列解析を文字数で明確に区別（1文字=風牌、2文字=数牌/三元牌）
- **次の課題**: フェーズ2（面子検出と和了判定）
